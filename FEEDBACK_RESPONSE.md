# Feedback Response: Demo Issues & Questions

## Summary of Issues Identified

1. **Morimoto Maui Hallucination**: The restaurant's `vibe_summary` field contains only "serves cuisine." which is extremely generic, causing it to match almost any query in vector search.

2. **Restaurant Name Matching**: The name matching logic may be too strict in some cases, missing partial matches or variations.

3. **Data Quality**: Some restaurants have incomplete or generic vibe summaries that cause false matches.

---

## Answers to Your Questions

### 1. Are you currently using the entire Maui DB info for the demo?

**Yes, the system uses the entire Maui database.**

- **Source**: `data/restaurants.json`
- **Total Restaurants**: 360 restaurants
- **Loading**: All restaurants are loaded into memory at startup (see `part1/src/pipeline.py:60-75`)
- **Vector Store**: All restaurants are embedded and stored in ChromaDB for similarity search

The system does NOT filter or subset the database - it uses all 360 restaurants from the JSON file.

---

### 2. Are these responses generated by a locally hosted model with information available from database or are you using web search information as well?

**Responses are generated using ONLY the local database - NO web search is used.**

**Architecture:**
- **LLM**: Google Gemini API (cloud-hosted, not local) - used for:
  - Query parsing (understanding user intent)
  - Response generation (natural language explanations)
- **Data Source**: 100% local database (`restaurants.json`)
- **Vector Search**: Local ChromaDB vector store (embeddings of restaurant vibe summaries)
- **Web Search**: Code exists for web search (`part1/src/gemini_client.py:46-87`) but it is **NOT enabled or called** in the current implementation

**What the LLM sees:**
- Only restaurant data from `restaurants.json`
- Restaurant fields: name, cuisine, price, location, rating, features, vibe summary, highlights, details, etc.
- NO external web search results
- NO real-time information

**Note**: The system could be enhanced with web search, but currently it's purely database-driven.

---

### 3. Why is the hallucination only happening with Morimoto Maui?

**CRITICAL FINDING: This is NOT just a Morimoto issue - it affects 359 out of 360 restaurants!**

**Root Cause: Generic/Incomplete Vibe Summary**

**Data Quality Audit Results:**
- **359 out of 360 restaurants** have the exact same generic `vibe_summary`: `"serves cuisine."`
- Only **1 restaurant** (Morimoto Maui - which we just fixed) had a different but still generic summary

This is a **massive data quality issue** that explains the hallucination problem:

1. **Vector Search**: The vector store uses `vibe_summary` to create embeddings for similarity search
2. **Identical Embeddings**: Since 359 restaurants have identical vibe summaries, they all create nearly identical embeddings
3. **Random Ranking**: When embeddings are identical, vector search results become essentially random
4. **Why Morimoto Appears**: Morimoto may appear more often due to:
   - Slightly different (but still generic) original summary
   - Higher rating (4.3/5.0) boosting it in final scoring
   - Price level ($$$$) matching certain queries
   - Location (South Shore, Wailea) matching location-based queries

**The Real Problem:**
- All restaurants have the same generic embedding, so vector search cannot differentiate between them
- The system relies on other signals (cuisine, price, location filters) and scoring to rank results
- This creates unpredictable and often irrelevant recommendations

**Solution Needed:**
- Fix Morimoto's `vibe_summary` in the database to be more specific
- Add validation to prevent generic vibe summaries
- Consider using `highlights` or `details` fields as fallback if `vibe_summary` is too generic

---

### 4. What all fields are you using from each restaurant to provide context to the model while answering questions?

**Fields Passed to LLM for Response Generation:**

The system passes the following restaurant fields to the LLM (see `part1/src/streaming_response_generator.py:340-361`):

**Basic Information:**
- `name` - Restaurant name
- `cuisine` - Cuisine type
- `price_level` / `price_level_curated` - Price range ($, $$, $$$, $$$$)
- `region` - Region (e.g., "SOUTH SHORE")
- `city` - City name
- `formatted_address` - Full address
- `rating` - Rating out of 5.0

**Features & Amenities:**
- `features` - Dictionary of boolean features (wheelchair_accessible, outdoor_seating, live_music, etc.)
- `serves_meal_times` - List of meal times (breakfast, lunch, dinner)
- `parking_options` - Parking availability details

**Business Details:**
- `business_status` - Operational status
- `is_open_now` - Current open status
- `opening_hours_text` - Opening hours
- `national_phone` / `international_phone` - Contact numbers
- `website_uri` - Website URL
- `google_maps_uri` - Google Maps link

**Descriptive Content:**
- `highlights` - Restaurant highlights (primary description)
- `details` - Additional details
- `editorial_summary` - Editorial description
- `vibe.vibe_summary` - Vibe description (used for embeddings)
- `vibe.formality` - Formality level (casual, upscale, etc.)
- `vibe.noise_level` - Noise level (quiet, moderate, loud)
- `vibe.atmosphere_tags` - Atmosphere tags (romantic, lively, etc.)
- `top_menu_items` - Popular menu items (if available)

**Media:**
- `video_urls` - Associated video URLs (from video_metadata.json lookup)

**Scoring Context:**
- `final_score` - Overall match score (0.0-1.0)
- `vibe_score`, `cuisine_score`, `price_score`, `feature_score` - Individual signal scores
- Match reasons explaining why the restaurant matches the query

**What is NOT passed:**
- Internal metadata (match_status, match_confidence, data_completeness_score)
- Raw location coordinates (latitude/longitude are not in the prompt)
- Photo URLs (not included in text prompt)
- Review text (not included)

---

## Recommended Fixes

### Immediate Fixes (CRITICAL):

1. **Fix ALL Restaurant Vibe Summaries** ⚠️ **URGENT**
   - **359 restaurants** need their `vibe_summary` fields updated
   - Use `editorial_summary`, `highlights`, or `details` as source material
   - Script available: `scripts/audit_vibe_summaries.py` to identify all affected restaurants
   - **This is the root cause of the hallucination issue**

2. **Add Data Validation**
   - Check for generic vibe summaries (e.g., "serves cuisine", "restaurant", etc.)
   - Use `highlights` or `details` as fallback if `vibe_summary` is too generic
   - Flag restaurants with incomplete data
   - **Prevent this from happening again**

3. **Improve Restaurant Name Matching**
   - Add fuzzy matching for common variations
   - Handle apostrophes and special characters better
   - Add normalization for common restaurant name patterns

### Long-term Improvements:

1. **Data Quality Checks**
   - Audit all restaurants for generic vibe summaries
   - Ensure all restaurants have meaningful descriptions
   - Add data completeness scoring

2. **Enhanced Filtering**
   - Add minimum relevance threshold for vector search results
   - Penalize restaurants with generic descriptions in scoring
   - Improve cuisine matching logic

3. **Better Error Handling**
   - When no exact match found, provide suggestions
   - Show partial matches when exact name not found
   - Improve user feedback for edge cases

---

## Technical Details

### Vector Search Process:
1. User query → LLM parses into `semantic_query`
2. `semantic_query` → Embedded using Gemini embedding model
3. Vector search finds top N restaurants (20-30) by similarity
4. Restaurants filtered by hard constraints (cuisine, location, price, etc.)
5. Remaining restaurants scored across multiple signals
6. Top results ranked and passed to LLM for response generation

### Why Morimoto Appears:
- Generic "serves cuisine." creates a broad embedding
- Matches many queries in vector search
- Passes filters (Japanese cuisine, $$$$ price, South Shore location)
- Gets high vibe_score due to generic embedding similarity
- Ranks high in final results

---

## Next Steps

1. **Immediate**: Fix Morimoto's vibe_summary in the database
2. **Short-term**: Add data validation and fallback logic
3. **Medium-term**: Audit all restaurants for data quality
4. **Long-term**: Implement better name matching and relevance filtering

