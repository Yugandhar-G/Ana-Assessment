# Ana AI - Complete Workflow Visualization

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         USER QUERY: "romantic hawaiian spot"                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                         â”‚
                                         â–¼
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                    PHASE 1: QUERY UNDERSTANDING (QueryParser)                   â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                                         â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                                â”‚                                â”‚
        â–¼                                â–¼                                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Typo Correction  â”‚          â”‚  Restaurant Name â”‚          â”‚  LLM Parsing     â”‚
â”‚                  â”‚          â”‚    Detection     â”‚          â”‚  (Gemini Flash)  â”‚
â”‚ hawaainâ†’hawaiian â”‚          â”‚                  â”‚          â”‚                  â”‚
â”‚ indainâ†’indian    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚ "mama fish" â†’    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚ Extract:         â”‚
â”‚ normalize text   â”‚          â”‚ "Mama's Fish     â”‚          â”‚ - semantic_query â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚  House"          â”‚          â”‚ - must_not{}     â”‚
                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚ - preferences{}  â”‚
                                                            â”‚ - weights{}      â”‚
                                                            â”‚ - location       â”‚
                                                            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                         â”‚
                                         â–¼
                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                              â”‚  Fallback Pattern Enrichment         â”‚
                              â”‚  - Extract cuisine from patterns     â”‚
                              â”‚  - Detect "live music", "romantic"   â”‚
                              â”‚  - Parse location "in Lahaina"       â”‚
                              â”‚  - Boost cuisine weights if explicit â”‚
                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                         â”‚
                                         â–¼
        â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
        â•‘              ParsedQuery Object (Structured Intent)            â•‘
        â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
        â•‘ raw_query: "romantic hawaiian spot"                            â•‘
        â•‘ semantic_query: "romantic restaurant hawaiian cuisine ocean    â•‘
        â•‘                  views scenic atmosphere"                      â•‘
        â•‘ must_not: {formality: [], price: [], cuisine: [], features:[]} â•‘
        â•‘ preferences: {                                                 â•‘
        â•‘   cuisine: ["Hawaiian"],                                       â•‘
        â•‘   features: [],                                                â•‘
        â•‘   atmosphere: ["romantic"]                                     â•‘
        â•‘ }                                                              â•‘
        â•‘ weights: {vibe: 0.6, cuisine: 0.2, price: 0.1, features: 0.1} â•‘
        â•‘ location: null                                                 â•‘
        â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                                         â”‚
                                         â–¼
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                      PHASE 2: CANDIDATE RETRIEVAL & FILTERING                   â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                                         â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                                â”‚                                â”‚
        â–¼                                â–¼                                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Exact Restaurant â”‚          â”‚ Dynamic n_resultsâ”‚          â”‚ Cuisine Query    â”‚
â”‚ Match Check      â”‚          â”‚   Calculation    â”‚          â”‚  Enhancement     â”‚
â”‚                  â”‚          â”‚                  â”‚          â”‚                  â”‚
â”‚ If found:        â”‚          â”‚ Base: 20         â”‚          â”‚ Repeat cuisine   â”‚
â”‚ â†’ 0.98 vibe boostâ”‚          â”‚ +10 if cuisine   â”‚          â”‚ 3x in semantic   â”‚
â”‚ â†’ Guaranteed #1  â”‚          â”‚ +10 if featuresâ‰¥2â”‚          â”‚ query for better â”‚
â”‚                  â”‚          â”‚ Final: 20-40     â”‚          â”‚ embeddings       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                         â”‚
                                         â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚    VECTOR SEARCH (ChromaDB)             â”‚
                    â”‚                                         â”‚
                    â”‚  Query: "hawaiian hawaiian hawaiian    â”‚
                    â”‚          romantic restaurant..."        â”‚
                    â”‚  Model: text-embedding-004              â”‚
                    â”‚  Method: Cosine similarity              â”‚
                    â”‚  Returns: Top 20-40 candidates          â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                         â”‚
                                         â–¼
                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                              â”‚   HARD FILTERING LOOP       â”‚
                              â”‚  (360 â†’ 20-40 candidates)   â”‚
                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                         â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â–¼            â–¼                  â–¼                  â–¼            â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ Business â”‚ â”‚ Formalityâ”‚      â”‚ Cuisine  â”‚      â”‚ Features â”‚ â”‚ Location â”‚
  â”‚  Status  â”‚ â”‚  Filter  â”‚      â”‚  Filter  â”‚      â”‚  Filter  â”‚ â”‚  Filter  â”‚
  â”‚          â”‚ â”‚          â”‚      â”‚          â”‚      â”‚          â”‚ â”‚          â”‚
  â”‚ Remove ifâ”‚ â”‚ Remove ifâ”‚      â”‚ Only if: â”‚      â”‚ Remove ifâ”‚ â”‚ Remove ifâ”‚
  â”‚ not OPEN â”‚ â”‚ in       â”‚      â”‚ - weightâ‰¥â”‚      â”‚ feature  â”‚ â”‚ not in   â”‚
  â”‚          â”‚ â”‚ must_not â”‚      â”‚   0.5 OR â”‚      â”‚ in       â”‚ â”‚ city/    â”‚
  â”‚          â”‚ â”‚          â”‚      â”‚ - explicitâ”‚      â”‚ must_not â”‚ â”‚ region   â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚   in queryâ”‚      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚           â”‚
                                 â”‚ Fuzzy matchâ”‚
                                 â”‚ "Hawaiian"=â”‚
                                 â”‚ "Hawaii    â”‚
                                 â”‚  Regional" â”‚
                                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                         â”‚
                                         â–¼
                    â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
                    â•‘    FILTERED CANDIDATES (10-30)          â•‘
                    â•‘    Ready for multi-signal scoring       â•‘
                    â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                                         â”‚
                                         â–¼
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                      PHASE 3: MULTI-SIGNAL SCORING (PARALLEL)                   â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                                         â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚            â”‚                  â”‚                  â”‚            â”‚
        â–¼            â–¼                  â–¼                  â–¼            â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  VIBE    â”‚ â”‚ CUISINE  â”‚      â”‚  PRICE   â”‚      â”‚ FEATURE  â”‚ â”‚          â”‚
  â”‚  SCORER  â”‚ â”‚  SCORER  â”‚      â”‚  SCORER  â”‚      â”‚  SCORER  â”‚ â”‚  async   â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤      â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤      â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚ gather() â”‚
  â”‚ Method:  â”‚ â”‚ Method:  â”‚      â”‚ Method:  â”‚      â”‚ Method:  â”‚ â”‚          â”‚
  â”‚ Cosine   â”‚ â”‚ Fuzzy    â”‚      â”‚ Euclideanâ”‚      â”‚ Jaccard  â”‚ â”‚ All run  â”‚
  â”‚ similarityâ”‚ â”‚ string   â”‚      â”‚ distance â”‚      â”‚ similarityâ”‚ â”‚ at same  â”‚
  â”‚          â”‚ â”‚ matching â”‚      â”‚          â”‚      â”‚          â”‚ â”‚ time!    â”‚
  â”‚ Input:   â”‚ â”‚          â”‚      â”‚ Input:   â”‚      â”‚ Input:   â”‚ â”‚          â”‚
  â”‚ - Query  â”‚ â”‚ Requestedâ”‚      â”‚ Requestedâ”‚      â”‚ Requestedâ”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  â”‚   embed  â”‚ â”‚ cuisine  â”‚      â”‚ price    â”‚      â”‚ features â”‚
  â”‚ - Vibe   â”‚ â”‚ vs       â”‚      â”‚ vs       â”‚      â”‚ vs       â”‚
  â”‚   embed  â”‚ â”‚ Restaurantâ”‚      â”‚ Restaurantâ”‚      â”‚ Restaurantâ”‚
  â”‚          â”‚ â”‚ cuisine  â”‚      â”‚ price    â”‚      â”‚ features â”‚
  â”‚ Output:  â”‚ â”‚          â”‚      â”‚          â”‚      â”‚          â”‚
  â”‚ 0.925    â”‚ â”‚ Output:  â”‚      â”‚ Output:  â”‚      â”‚ Output:  â”‚
  â”‚          â”‚ â”‚ 1.0      â”‚      â”‚ 0.75     â”‚      â”‚ 0.65     â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                         â”‚
                                         â–¼
                    â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
                    â•‘  Each Restaurant Has 4 Scores:          â•‘
                    â•‘  vibe=0.925, cuisine=1.0,               â•‘
                    â•‘  price=0.75, features=0.65              â•‘
                    â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                                         â”‚
                                         â–¼
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                        PHASE 4: ADVANCED SCORE FUSION                           â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                                         â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                                                                  â”‚
        â–¼                                                                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                    â”Œâ”€â”€â”€â”€â”€ï¿½ï¿½ï¿½â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Non-Linear Transform â”‚                                    â”‚  Weighted Sum        â”‚
â”‚                      â”‚                                    â”‚  (Base Score)        â”‚
â”‚ sqrt(score) to boost â”‚                                    â”‚                      â”‚
â”‚ high scores:         â”‚                                    â”‚ 0.6Ã—0.925 = 0.555   â”‚
â”‚ - 0.90 â†’ 0.95       â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚ 0.2Ã—1.0   = 0.200   â”‚
â”‚ - 0.50 â†’ 0.71       â”‚                                    â”‚ 0.1Ã—0.75  = 0.075   â”‚
â”‚ - 0.10 â†’ 0.32       â”‚                                    â”‚ 0.1Ã—0.65  = 0.065   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                    â”‚                      â”‚
                                                            â”‚ Base = 0.895         â”‚
                                                            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                         â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â–¼            â–¼                  â–¼                  â–¼            â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚Interactionâ”‚ â”‚ Perfect  â”‚      â”‚  Award   â”‚      â”‚ Penaltiesâ”‚ â”‚  Final   â”‚
  â”‚  Bonuses â”‚ â”‚  Match   â”‚      â”‚  Boost   â”‚      â”‚          â”‚ â”‚ Calculationâ”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚  Boosts  â”‚      â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤      â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚          â”‚ â”‚          â”‚      â”‚          â”‚      â”‚          â”‚ â”‚          â”‚
  â”‚Cuisine & â”‚ â”‚Cuisineâ‰¥  â”‚      â”‚Gold Awardâ”‚      â”‚Missing   â”‚ â”‚final =   â”‚
  â”‚Features  â”‚ â”‚0.95:     â”‚      â”‚+0.15     â”‚      â”‚wheelchairâ”‚ â”‚ base +   â”‚
  â”‚both>0.6: â”‚ â”‚+0.08     â”‚      â”‚          â”‚      â”‚-0.25     â”‚ â”‚ interact+â”‚
  â”‚+0.10     â”‚ â”‚          â”‚      â”‚Silver    â”‚      â”‚          â”‚ â”‚ perfect +â”‚
  â”‚          â”‚ â”‚Featuresâ‰¥ â”‚      â”‚+0.12     â”‚      â”‚Cuisine   â”‚ â”‚ award -  â”‚
  â”‚Vibe &    â”‚ â”‚0.95:     â”‚      â”‚          â”‚      â”‚mismatch  â”‚ â”‚ penalty  â”‚
  â”‚Cuisine   â”‚ â”‚+0.08     â”‚      â”‚Honorable â”‚      â”‚-0.30     â”‚ â”‚          â”‚
  â”‚both>0.6: â”‚ â”‚          â”‚      â”‚+0.08     â”‚      â”‚          â”‚ â”‚Clamp to  â”‚
  â”‚+0.08     â”‚ â”‚Vibeâ‰¥0.95:â”‚      â”‚          â”‚      â”‚Loud when â”‚ â”‚[0.0,1.0] â”‚
  â”‚          â”‚ â”‚+0.05     â”‚      â”‚Other     â”‚      â”‚quiet     â”‚ â”‚          â”‚
  â”‚Triple    â”‚ â”‚          â”‚      â”‚+0.05     â”‚      â”‚-0.40     â”‚ â”‚= 0.89    â”‚
  â”‚>0.6:     â”‚ â”‚          â”‚      â”‚          â”‚      â”‚          â”‚ â”‚          â”‚
  â”‚+0.12     â”‚ â”‚          â”‚      â”‚          â”‚      â”‚          â”‚ â”‚          â”‚
  â”‚          â”‚ â”‚          â”‚      â”‚          â”‚      â”‚          â”‚ â”‚          â”‚
  â”‚Max: 0.20 â”‚ â”‚Max: 0.15 â”‚      â”‚          â”‚      â”‚Max: 0.50 â”‚ â”‚          â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                         â”‚
                                         â–¼
                    â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
                    â•‘      SCORED RESTAURANTS                 â•‘
                    â•‘  Each has: vibe, cuisine, price,        â•‘
                    â•‘  feature, and FINAL score               â•‘
                    â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                                         â”‚
                                         â–¼
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                    PHASE 5: RANKING WITH AWARD PRIORITY                         â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                                         â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚                                         â”‚
                    â–¼                                         â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ Initial Sort by Score â”‚              â”‚  Award Priority       â”‚
        â”‚                       â”‚              â”‚  Re-Ranking (Top 10)  â”‚
        â”‚ Sort all restaurants  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                       â”‚
        â”‚ by final_score (desc) â”‚              â”‚ 1. Separate award     â”‚
        â”‚                       â”‚              â”‚    winners vs non     â”‚
        â”‚                       â”‚              â”‚                       â”‚
        â”‚                       â”‚              â”‚ 2. Sort award winners:â”‚
        â”‚                       â”‚              â”‚    - Award level desc â”‚
        â”‚                       â”‚              â”‚    - Rating desc      â”‚
        â”‚                       â”‚              â”‚    - Score desc       â”‚
        â”‚                       â”‚              â”‚                       â”‚
        â”‚                       â”‚              â”‚ 3. Sort non-award:    â”‚
        â”‚                       â”‚              â”‚    - Rating desc      â”‚
        â”‚                       â”‚              â”‚    - Score desc       â”‚
        â”‚                       â”‚              â”‚                       â”‚
        â”‚                       â”‚              â”‚ 4. Combine:           â”‚
        â”‚                       â”‚              â”‚    Awards first,      â”‚
        â”‚                       â”‚              â”‚    then others        â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                         â”‚
                                         â–¼
                    â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
                    â•‘     RANKED RESULTS (10-30 restaurants)  â•‘
                    â•‘  #1: Mama's Fish House (0.89)           â•‘
                    â•‘  #2: Merriman's Kapalua (0.85)          â•‘
                    â•‘  #3: Lahaina Grill (0.82)               â•‘
                    â•‘  ...                                    â•‘
                    â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                                         â”‚
                                         â–¼
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                         PHASE 6: RESPONSE GENERATION                            â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                                         â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚            â”‚                  â”‚                  â”‚            â”‚
        â–¼            â–¼                  â–¼                  â–¼            â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ Select   â”‚ â”‚ Generate â”‚      â”‚  Lookup  â”‚      â”‚ Build    â”‚ â”‚ LLM      â”‚
  â”‚ Top +    â”‚ â”‚  Match   â”‚      â”‚  Video & â”‚      â”‚ Prompt   â”‚ â”‚ Generate â”‚
  â”‚ Alts     â”‚ â”‚  Reasons â”‚      â”‚  Photos  â”‚      â”‚          â”‚ â”‚ Response â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤      â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤      â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚          â”‚ â”‚          â”‚      â”‚          â”‚      â”‚          â”‚ â”‚          â”‚
  â”‚Top: #1   â”‚ â”‚Primary:  â”‚      â”‚Query     â”‚      â”‚Combine:  â”‚ â”‚Model:    â”‚
  â”‚          â”‚ â”‚VIBE      â”‚      â”‚video_    â”‚      â”‚- Top     â”‚ â”‚Gemini    â”‚
  â”‚Alts:     â”‚ â”‚score=0.93â”‚      â”‚metadata  â”‚      â”‚  match   â”‚ â”‚Flash     â”‚
  â”‚#2-#4     â”‚ â”‚          â”‚      â”‚.json by  â”‚      â”‚- Reasons â”‚ â”‚          â”‚
  â”‚          â”‚ â”‚Secondary:â”‚      â”‚ID/name   â”‚      â”‚- Videos  â”‚ â”‚Temp: 0.4 â”‚
  â”‚Criteria: â”‚ â”‚CUISINE   â”‚      â”‚          â”‚      â”‚- Photos  â”‚ â”‚Tokens:   â”‚
  â”‚- scoreâ‰¥  â”‚ â”‚score=1.0 â”‚      â”‚Get URLs  â”‚      â”‚- Alts    â”‚ â”‚3000      â”‚
  â”‚  0.4     â”‚ â”‚          â”‚      â”‚          â”‚      â”‚          â”‚ â”‚          â”‚
  â”‚- match   â”‚ â”‚Minor:    â”‚      â”‚Attach to â”‚      â”‚System:   â”‚ â”‚Output:   â”‚
  â”‚  cuisine â”‚ â”‚PRICE     â”‚      â”‚response  â”‚      â”‚"Friendly â”‚ â”‚Natural   â”‚
  â”‚  if      â”‚ â”‚score=0.75â”‚      â”‚          â”‚      â”‚ helpful  â”‚ â”‚language  â”‚
  â”‚  requestedâ”‚ â”‚          â”‚      â”‚          â”‚      â”‚ concise" â”‚ â”‚explanationâ”‚
  â”‚- match   â”‚ â”‚          â”‚      â”‚          â”‚      â”‚          â”‚ â”‚with all  â”‚
  â”‚  locationâ”‚ â”‚          â”‚      â”‚          â”‚      â”‚User:     â”‚ â”‚details   â”‚
  â”‚          â”‚ â”‚          â”‚      â”‚          â”‚      â”‚"Query +  â”‚ â”‚          â”‚
  â”‚Keep top  â”‚ â”‚          â”‚      â”‚          â”‚      â”‚ top +    â”‚ â”‚"Mama's   â”‚
  â”‚3-9       â”‚ â”‚          â”‚      â”‚          â”‚      â”‚ alts +   â”‚ â”‚Fish Houseâ”‚
  â”‚          â”‚ â”‚          â”‚      â”‚          â”‚      â”‚ instruct"â”‚ â”‚is an     â”‚
  â”‚          â”‚ â”‚          â”‚      â”‚          â”‚      â”‚          â”‚ â”‚excellent â”‚
  â”‚          â”‚ â”‚          â”‚      â”‚          â”‚      â”‚          â”‚ â”‚match for â”‚
  â”‚          â”‚ â”‚          â”‚      â”‚          â”‚      â”‚          â”‚ â”‚your      â”‚
  â”‚          â”‚ â”‚          â”‚      â”‚          â”‚      â”‚          â”‚ â”‚romantic  â”‚
  â”‚          â”‚ â”‚          â”‚      â”‚          â”‚      â”‚          â”‚ â”‚Hawaiian  â”‚
  â”‚          â”‚ â”‚          â”‚      â”‚          â”‚      â”‚          â”‚ â”‚dining... â”‚
  â”‚          â”‚ â”‚          â”‚      â”‚          â”‚      â”‚          â”‚ â”‚Check out â”‚
  â”‚          â”‚ â”‚          â”‚      â”‚          â”‚      â”‚          â”‚ â”‚photos..."â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                         â”‚
                                         â–¼
                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                              â”‚  Determine Confidence       â”‚
                              â”‚                             â”‚
                              â”‚  if scoreâ‰¥0.8: "high"      â”‚
                              â”‚  elif scoreâ‰¥0.6: "medium"  â”‚
                              â”‚  else: "low"               â”‚
                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                         â”‚
                                         â–¼
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                           FINAL ANA RESPONSE                                    â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘  {                                                                              â•‘
â•‘    "success": true,                                                             â•‘
â•‘    "top_match": {                                                               â•‘
â•‘      "name": "Mama's Fish House",                                               â•‘
â•‘      "cuisine": "Hawaii Regional Cuisine",                                      â•‘
â•‘      "price_level": "$$$",                                                      â•‘
â•‘      "rating": 4.6,                                                             â•‘
â•‘      "final_score": 0.89,                                                       â•‘
â•‘      "vibe_score": 0.93, "cuisine_score": 1.0,                                 â•‘
â•‘      "price_score": 0.75, "feature_score": 0.65,                               â•‘
â•‘      "features": {...}, "video_urls": [...], "photos_urls": [...]              â•‘
â•‘      /* Full restaurant details */                                              â•‘
â•‘    },                                                                           â•‘
â•‘    "alternatives": [                                                            â•‘
â•‘      { /* Merriman's Kapalua */ },                                              â•‘
â•‘      { /* Lahaina Grill */ }                                                    â•‘
â•‘    ],                                                                           â•‘
â•‘    "match_reasons": [                                                           â•‘
â•‘      {"signal": "vibe", "importance": "primary", "score": 0.93},                â•‘
â•‘      {"signal": "cuisine", "importance": "secondary", "score": 1.0}             â•‘
â•‘    ],                                                                           â•‘
â•‘    "explanation": "Mama's Fish House is an excellent match for your            â•‘
â•‘                    romantic Hawaiian dining experience. This award-             â•‘
â•‘                    winning restaurant offers Hawaii Regional Cuisine...         â•‘
â•‘                    Check out their beautiful ambiance in these photos:          â•‘
â•‘                    [photo URLs]...",                                            â•‘
â•‘    "confidence": "high"                                                         â•‘
â•‘  }                                                                              â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                                         â”‚
                                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              USER SEES RESPONSE                                  â”‚
â”‚                                                                                  â”‚
â”‚  "Mama's Fish House is an excellent match for your romantic Hawaiian dining     â”‚
â”‚   experience. This award-winning restaurant offers Hawaii Regional Cuisine in   â”‚
â”‚   an intimate oceanfront setting, perfect for the romantic atmosphere you're    â”‚
â”‚   seeking. Rated 4.6/5.0, it provides an upscale dining experience with        â”‚
â”‚   stunning ocean views and authentic Hawaiian flavors. You can see photos of    â”‚
â”‚   the restaurant here: [photo URL]. Check out their beautiful ambiance in       â”‚
â”‚   this video: [video URL].                                                      â”‚
â”‚                                                                                  â”‚
â”‚   If you're looking for other options, also consider Merriman's Kapalua..."     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                              KEY FEATURES SUMMARY
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ§  INTELLIGENT QUERY UNDERSTANDING
   â”œâ”€ LLM-based intent extraction (structured JSON from natural language)
   â”œâ”€ Typo correction & normalization
   â”œâ”€ Dynamic weight assignment based on query emphasis
   â””â”€ Restaurant name detection with fuzzy matching

ğŸ” HYBRID RETRIEVAL SYSTEM
   â”œâ”€ Vector search (semantic similarity via embeddings)
   â”œâ”€ Hard filtering (boolean constraints: must_not)
   â”œâ”€ Soft filtering (preferences weighted in scoring)
   â””â”€ Dynamic candidate pool (20-40 based on query complexity)

ğŸ¯ MULTI-SIGNAL SCORING (PARALLEL EXECUTION)
   â”œâ”€ Vibe Score: Cosine similarity of embeddings
   â”œâ”€ Cuisine Score: Fuzzy string matching with variations
   â”œâ”€ Price Score: Euclidean distance in price space
   â””â”€ Feature Score: Jaccard similarity of feature sets

âš–ï¸ ADVANCED SCORE FUSION
   â”œâ”€ Non-linear transformations (sqrt boost)
   â”œâ”€ Weighted sum (dynamic weights from query)
   â”œâ”€ Interaction bonuses (when multiple signals align)
   â”œâ”€ Perfect match boosts (exponential for â‰¥0.95 scores)
   â”œâ”€ Award recognition boost (Gold/Silver/Honorable)
   â””â”€ Safety penalties (accessibility, noise level)

ğŸ† AWARD-PRIORITY RANKING
   â”œâ”€ Regex detection of awards in restaurant metadata
   â”œâ”€ Award level classification (Gold > Silver > Honorable)
   â””â”€ Priority re-ranking within top 10 results

ğŸ’¬ NATURAL LANGUAGE GENERATION
   â”œâ”€ LLM-generated explanations (Gemini Flash)
   â”œâ”€ Match reasons (why each restaurant matched)
   â”œâ”€ Video & photo integration from metadata
   â”œâ”€ Detailed alternative discussions
   â””â”€ Confidence scoring (high/medium/low)

âš¡ PERFORMANCE OPTIMIZATIONS
   â”œâ”€ Embedding caching (reduces API calls 30-50%)
   â”œâ”€ Parallel async scoring (all 4 signals at once)
   â”œâ”€ Query classification caching
   â”œâ”€ Persistent ChromaDB (instant on subsequent runs)
   â””â”€ ~2 second latency after initial setup

ğŸ›¡ï¸ SAFETY & ACCESSIBILITY
   â”œâ”€ Hard penalties for missing wheelchair access (-0.25)
   â”œâ”€ Noise level penalties for elderly users (-0.4)
   â”œâ”€ Cuisine mismatch detection and penalties
   â””â”€ Business status filtering (operational only)

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                              LATENCY BREAKDOWN
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Phase 1: Query Understanding         ~400ms  (LLM call)
Phase 2: Vector Search               ~100ms  (ChromaDB)
Phase 3: Multi-Signal Scoring        ~300ms  (parallel, cached embeddings)
Phase 4: Score Fusion                ~10ms   (computation only)
Phase 5: Ranking                     ~5ms    (sorting)
Phase 6: Response Generation         ~500ms  (LLM call)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
TOTAL (after vector store init):     ~1.3s

First-time initialization:           30-60s  (embedding generation)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

## Visual Legend

- `â”Œâ”€â”` - Process/Component boxes
- `â•”â•â•—` - Major phase headers
- `â”‚ â–¼ â”‚` - Flow direction
- `â”œâ”€â”¤` - Sub-components
- `â†’` - Data transformation
- `PARALLEL` - Concurrent execution
- `CRITICAL` - Safety-critical logic

## Flow Summary

1. **Query** â†’ Parse with LLM â†’ Structured Intent
2. **Intent** â†’ Vector Search + Hard Filters â†’ Candidates
3. **Candidates** â†’ 4 Parallel Scorers â†’ Individual Scores
4. **Scores** â†’ Fusion Engine â†’ Final Scores
5. **Scored** â†’ Award-Priority Ranking â†’ Ranked List
6. **Ranked** â†’ LLM Response Generator â†’ Natural Language + Media
7. **Response** â†’ User receives detailed, conversational recommendation

**Total Pipeline**: 6 phases, ~1.3 seconds, hybrid AI approach combining vector search, structured logic, and LLM reasoning.
